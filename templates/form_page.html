{% extends 'base.html' %}

{% block content %}
    <div class="container my-5 shadow-sm">
        <div class="card">
            <div class="card-header bg-body-tertiary text-bg-info">
                <h1 class="mb-0">Welcome to Concert Match</h1>
                <p class="lead mb-0">Please fill in your favorite genre, artist, and preferred timeframe to generate concert choices.</p>
            </div>
            <div class="card-body">
                {% if user.is_authenticated %}
                    <form id="concertForm" method="post" action="{% url 'submit_profile' %}">
                        {% csrf_token %}

                        <div class="mb-3">
                            <label for="favorite_artist" class="form-label">Favorite Artist:</label>
                            <input type="text" id="favorite_artist" name="favorite_artist" class="form-control" required>
                        </div>

                        <div class="mb-3">
                            <label for="favorite_genre" class="form-label">Favorite Genre:</label>
                            <input type="text" id="favorite_genre" name="favorite_genre" class="form-control" required>
                        </div>

<div class="mb-3">
    <label for="preferred_location" class="form-label">Preferred Location:</label>
    <input type="text" id="preferred_location" name="preferred_location" class="form-control" required>
</div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="preferred_timeframe_start" class="form-label">Preferred Timeframe (Start Date):</label>
                                <input type="date" id="preferred_timeframe_start" name="preferred_timeframe_start" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="preferred_timeframe_end" class="form-label">Preferred Timeframe (End Date):</label>
                                <input type="date" id="preferred_timeframe_end" name="preferred_timeframe_end" class="form-control" required>
                            </div>
                        </div>

                        <div class="text-center mt-3 mb-3"> <!-- Center the button -->
                            <button type="button" id="submitBtn" class="btn btn-primary">Submit</button>
                        </div>
                    </form>

                    <!-- Concert Results Section -->
                    <div id="concertResultsContainer" class="container">
                        <div class="row justify-content-center my-4 shadow">
                            <div class="col bg-white p-4">
                                <div id="concertResults"></div>
                            </div>
                        </div>
                    </div>

                {% else %}
                    <div>
                        <a class="btn btn-danger" href="{% url 'login' %}">Login</a>
                        <a class="btn btn-danger" href="{% url 'register' %}">Register</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#submitBtn").click(function () {
                // Get user inputs
        var favoriteArtist = $("#favorite_artist").val();
        var favoriteGenre = $("#favorite_genre").val();
        var location = $("#preferred_location").val();  // Fix: Removed colon

        var startDate = $("#preferred_timeframe_start").val();
        var endDate = $("#preferred_timeframe_end").val();

                // Make an API request to your Django view
                $.ajax({
                    type: "GET",
                    url: "{% url 'get_events' %}",
                    data: {
                        searchTerm: favoriteGenre,  // or favoriteArtist based on your view function
                        location: "YourLocation",  // Replace with the actual location or remove if not needed
                        startDate: startDate,
                        endDate: endDate
                    },
                    success: function (data) {
                        // Update the concert results container with the received data
                        displayConcertResults(data);
                    },
                    error: function () {
                        // Handle error
                        console.log("Error fetching concert data");
                    }
                });
            });
        });

        // Function to display concert results
        function displayConcertResults(data) {
            var resultsHtml = "";
            // Customize this part based on the structure of the received data
            for (var i = 0; i < data.length; i++) {
                resultsHtml += '<div class="card m-2 my-4 rounded shadow">';
                // Add concert details to resultsHtml
                // ...
                resultsHtml += '</div>';
            }
            // Update the concert results container with the formatted HTML
            $("#concertResults").html(resultsHtml);
        }
    </script>
{% endblock %}
